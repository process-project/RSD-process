<html>
    <head>
        <script type="application/javascript">
            const url = 'https://www.research-software.nl/api/software_cache';
            fetch(url)
            .then((resp) => resp.json())
            .then((items) => {
                // number of unique contributors
                const contributors = new Set();
                let add_contributors = (doc) => {
                    doc.contributors.forEach((contributor) => {
                        contributors.add(contributor.foreignKey.primaryKey.id)
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_contributors);
                console.log(contributors);



                // number of citable brands
                let brands = items.filter((item) => {return item.isPublished});
                // number of citable brands
                let citable_brands = items.filter((item) => {return item.isPublished && item.isCitable});



                // number of unique commits
                let number_of_commits = 0;
                let add_commits = (doc) => {
                    let keys = Object.keys(doc.commits);
                    for (let key of keys) {
                        number_of_commits += doc.commits[key];
                    }
                };
                items.filter((item) => {return item.isPublished}).forEach(add_commits);


                let orgs = new Set();
                items.forEach((item) => {
                    item.related.organizations.forEach((org) => {
                        orgs.add(org.foreignKey.primaryKey.id)
                    })
                })



                // number of unique organizations
                const organizations = new Set();
                let add_organizations = (doc) => {
                    doc.related.organizations.forEach((organization) => {
                        organizations.add(organization.foreignKey.primaryKey.id)
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_organizations);



                // number of unique projects
                const projects = new Set();
                let add_projects = (doc) => {
                    doc.related.projects.forEach((project) => {
                        projects.add(project.foreignKey.primaryKey.id)
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_projects);



                // number of unique repositories
                const repositories = new Set();
                let add_repositories = (doc) => {
                    for (let repotype in doc.repositoryURLs) {
                        doc.repositoryURLs[repotype].forEach((repo_url) => {repositories.add(repo_url)})
                    }
                };
                items.filter((item) => {return item.isPublished}).forEach(add_repositories);



                // number of unique scientific publications
                const scipubs = new Set();
                const scipub_types = new Set(["conferencePaper", "journalArticle"])
                let add_scipubs = (doc) => {
                    doc.related.mentions.forEach((mention) => {
                        if (scipub_types.has(mention.foreignKey.type)) {
                            scipubs.add(mention.foreignKey.primaryKey.id);
                        };
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_scipubs);



                // number of unique mainstream media publications
                const mmpubs = new Set();
                const mmpub_types = new Set(["blogPost",
                                             "interview",
                                             "magazineArticle",
                                             "newspaperArticle",
                                             "radioBroadcast",
                                             "videoRecording"])
                let add_mmpubs = (doc) => {
                    doc.related.mentions.forEach((mention) => {
                        if (mmpub_types.has(mention.foreignKey.type)) {
                            mmpubs.add(mention.foreignKey.primaryKey.id);
                        };
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_mmpubs);



                // number of unique publications of any type
                const allpubs = new Set();
                let add_pubs = (doc) => {
                    doc.related.mentions.forEach((mention) => {
                        allpubs.add(mention.foreignKey.primaryKey.id);
                    });
                };
                items.filter((item) => {return item.isPublished}).forEach(add_pubs);



                // number of unique permissively licensed brands
                const permissive_license_types = new Set(["Apache-2.0",
                                                          "GPL-2.0",
                                                          "GPL-3.0",
                                                          "LGPL-2.0",
                                                          "MIT"])
                const permissively_licensed = items.filter((item) => {return item.isPublished})
                .filter((item) => {return permissive_license_types.has(item.license[0])});



                const print_overview = () => {
                    document.write("<p>published brands: " + brands.length + "</p>")
                    document.write("<p>published brands with doi: " + citable_brands.length + "</p>")
                    document.write("<p>unique contributors: " + contributors.size + "</p>")
                    document.write("<p>commits: " + number_of_commits + "</p>")
                    document.write("<p>unique organizations: " + organizations.size + "</p>")
                    document.write("<p>unique projects: " + projects.size + "</p>")
                    document.write("<p>unique repositories: " + repositories.size + "</p>")
                    document.write("<p>unique scientific publications: " + scipubs.size + "</p>")
                    document.write("<p>unique mainstream media publications: " + mmpubs.size + "</p>")
                    document.write("<p>total number of unique publications of any type: " + allpubs.size + "</p>")
                    document.write("<p>permissive license (Apache-2.0, GPL-2.0, GPL-3.0, LGPL-2.0, MIT): " + permissively_licensed.length + "</p>")
                }

                print_overview();
            })
            .catch(function(error) {
                console.log(JSON.stringify(error));
            });
        </script>
    </head>

    <body>
    </body>
</html>
